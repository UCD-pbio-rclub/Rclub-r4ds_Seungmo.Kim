# 09132017_Kim.Seungmo



 
21.4.1 Exercises

1. Read the documentation for apply(). In the 2d case, what two for loops does it generalise?

double loops..it means there is a nested for loop in loop.

2. Adapt col_summary() so that it only applies to numeric columns You might want to start with an is_numeric() function that returns a logical vector that has a TRUE corresponding to each numeric column.?????????

```r
col_summary <- function(df, fun) {
  out <- vector("double", length(df))
  out_col <- vector("double", length(df))
  for (i in seq_along(df)) {
    out[i] <- fun(df[[i]])
  }
  out
}
col_summary(nycflights13::flights, is.numeric)
```

```
##  [1] 1 1 1 1 1 1 1 1 1 0 1 0 0 0 1 1 1 1 0
```

```r
mtcars
```

```
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
```

21.5.3 Exercises

1. Write code that uses one of the map functions to:

  1.Compute the mean of every column in mtcars.

```r
map_dbl(mtcars, mean)
```

```
##        mpg        cyl       disp         hp       drat         wt 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500   0.406250   3.687500   2.812500
```

  2.Determine the type of each column in nycflights13::flights.

```r
map_chr(nycflights13::flights, typeof)
```

```
##           year          month            day       dep_time sched_dep_time 
##      "integer"      "integer"      "integer"      "integer"      "integer" 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##       "double"      "integer"      "integer"       "double"    "character" 
##         flight        tailnum         origin           dest       air_time 
##      "integer"    "character"    "character"    "character"       "double" 
##       distance           hour         minute      time_hour 
##       "double"       "double"       "double"       "double"
```

  3.Compute the number of unique values in each column of iris.

```r
map_dbl(mtcars, function(x) length(unique(x)))
```

```
##  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb 
##   25    3   27   22   22   29   30    2    2    3    6
```

  4.Generate 10 random normals for each of μ=-10, 0, 10 and 100.

```r
map(c(-10, 0, 10, 100), function(x) rnorm(10, x))
```

```
## [[1]]
##  [1] -10.159707  -9.486502  -9.338945  -8.387465  -9.838292  -9.183685
##  [7] -11.509282 -10.362687 -10.931382 -10.174970
## 
## [[2]]
##  [1] -0.6322445  0.1067406 -1.4193487 -0.8700872  0.2165402  0.4035296
##  [7]  0.8351976  1.2333607 -0.8299926  0.6436532
## 
## [[3]]
##  [1]  9.850524  9.987111  9.593416  8.972342  9.619834 11.401233  9.298372
##  [8] 10.658123  8.837817 11.368973
## 
## [[4]]
##  [1] 100.63204  97.76197 100.79422 101.33975 100.06440 101.03145 100.02793
##  [8] 100.65848  98.25682 100.07705
```

 
2. How can you create a single vector that for each column in a data frame indicates whether or not it’s a factor?


3.What happens when you use the map functions on vectors that aren’t lists? What does map(1:5, runif) do? Why?

```r
map(1:5, runif)
```

```
## [[1]]
## [1] 0.01449639
## 
## [[2]]
## [1] 0.03107608 0.34455892
## 
## [[3]]
## [1] 0.9963010 0.7807916 0.1582494
## 
## [[4]]
## [1] 0.14606280 0.09376785 0.31337879 0.27438237
## 
## [[5]]
## [1] 0.30411268 0.01357689 0.43960827 0.25706161 0.94826660
```


4.What does map(-2:2, rnorm, n = 5) do? Why? What does map_dbl(-2:2, rnorm, n = 5) do? Why?

```r
mtcars %>% map(sum) #return a list
```

```
## $mpg
## [1] 642.9
## 
## $cyl
## [1] 198
## 
## $disp
## [1] 7383.1
## 
## $hp
## [1] 4694
## 
## $drat
## [1] 115.09
## 
## $wt
## [1] 102.952
## 
## $qsec
## [1] 571.16
## 
## $vs
## [1] 14
## 
## $am
## [1] 13
## 
## $gear
## [1] 118
## 
## $carb
## [1] 90
```

```r
mtcars %>% map_dbl(sum) #return a double vector
```

```
##      mpg      cyl     disp       hp     drat       wt     qsec       vs 
##  642.900  198.000 7383.100 4694.000  115.090  102.952  571.160   14.000 
##       am     gear     carb 
##   13.000  118.000   90.000
```

```r
map(-2:2, rnorm, n = 5) 
```

```
## [[1]]
## [1] -1.945135 -4.075472 -3.130232 -2.866913 -3.491465
## 
## [[2]]
## [1] -2.4916228 -0.2346339 -2.1448656 -1.7881574 -0.4639186
## 
## [[3]]
## [1]  0.1037311  0.2119753  0.6442962 -1.1068189  0.3514113
## 
## [[4]]
## [1] 0.6128241 2.8044348 1.1485414 0.9139938 0.7224824
## 
## [[5]]
## [1] 1.9518507 1.1819727 0.9867494 1.7597694 2.2466007
```

```r
#map_dbl(-2:2, rnorm, n = 5) #return a double vector

#e.g.
1:10 %>%
  map(rnorm, n = 10) %>%
  map_dbl(mean)
```

```
##  [1]  1.208955  1.819302  2.885299  4.169493  5.372166  5.648547  6.730555
##  [8]  7.889647  9.513159 10.402745
```


5.Rewrite map(x, function(df) lm(mpg ~ wt, data = df)) to eliminate the anonymous function.

```r
# If we choose not to give the function a name, we get an anonymous function.
#1) give it a name -> quite verbose!
linear_model <- map(x, function(df) lm(mpg ~ wt, data = df))
map(mtcars)
map(x, function(df) linear_model(df))
map(mtcars)
#2)
(function(x) mtcars) ()
models <- mtcars %>% 
  split(.$cyl) %>% 
  map(~lm(mpg ~ wt, data = .))
```

21.9.3 Exercises

1. Implement your own version of every() using a for loop. Compare it with purrr::every(). What does purrr’s version do that your version doesn’t?

```r
x <- list(1:5, 2:9)
y <- list(0:10, c("a", "b", "c"))

x %>% every(is.numeric)
```

```
## [1] TRUE
```

```r
y %>% every(is.numeric)
```

```
## [1] FALSE
```

```r
count <- 0
for (val in x) {
    if(is.numeric(val))   count = count + 1
}
print(count)
```

```
## [1] 2
```

```r
sums <- 0
for (val in x) {
  print(sums)
  sums <- (sums + val)
  print(sums)
}
```

```
## [1] 0
## [1] 1 2 3 4 5
## [1] 1 2 3 4 5
```

```
## Warning in sums + val: longer object length is not a multiple of shorter
## object length
```

```
## [1]  3  5  7  9 11  8 10 12
```

```r
x <- list(0:10, 1000)
y <- list(0:10, c("a", "b", "c"))
x %>% every(is.numeric)
```

```
## [1] TRUE
```

```r
y %>% every(is.numeric)
```

```
## [1] FALSE
```

```r
#return TRUE or FALSE if every elements of a list satisfy a predicate

# every() equally treat every elements of a list but for loop doesn't
```

2. Create an enhanced col_sum() that applies a summary function to every numeric column in a data frame.

```r
col_sum <- function(df) {
  df[sapply(df, class) == 'numeric', ] %>%
   summary()
}

col_sum(nycflights13::flights)
```

```
##       year          month             day           dep_time   
##  Min.   :2013   Min.   : 1.000   Min.   : 1.00   Min.   :   1  
##  1st Qu.:2013   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.: 907  
##  Median :2013   Median : 7.000   Median :16.00   Median :1401  
##  Mean   :2013   Mean   : 6.549   Mean   :15.71   Mean   :1349  
##  3rd Qu.:2013   3rd Qu.:10.000   3rd Qu.:23.00   3rd Qu.:1744  
##  Max.   :2013   Max.   :12.000   Max.   :31.00   Max.   :2400  
##                                                  NA's   :2612  
##  sched_dep_time   dep_delay          arr_time    sched_arr_time
##  Min.   : 106   Min.   : -32.00   Min.   :   1   Min.   :   1  
##  1st Qu.: 905   1st Qu.:  -5.00   1st Qu.:1105   1st Qu.:1125  
##  Median :1359   Median :  -1.00   Median :1535   Median :1556  
##  Mean   :1344   Mean   :  12.75   Mean   :1502   Mean   :1536  
##  3rd Qu.:1729   3rd Qu.:  11.00   3rd Qu.:1941   3rd Qu.:1945  
##  Max.   :2359   Max.   :1014.00   Max.   :2400   Max.   :2359  
##                 NA's   :2612      NA's   :2754                 
##    arr_delay          carrier              flight       tailnum         
##  Min.   : -86.000   Length:106350      Min.   :   1   Length:106350     
##  1st Qu.: -17.000   Class :character   1st Qu.: 553   Class :character  
##  Median :  -5.000   Mode  :character   Median :1496   Mode  :character  
##  Mean   :   7.098                      Mean   :1970                     
##  3rd Qu.:  14.000                      3rd Qu.:3461                     
##  Max.   :1007.000                      Max.   :8500                     
##  NA's   :2988                                                           
##     origin              dest              air_time        distance   
##  Length:106350      Length:106350      Min.   : 20.0   Min.   :  17  
##  Class :character   Class :character   1st Qu.: 82.0   1st Qu.: 502  
##  Mode  :character   Mode  :character   Median :130.0   Median : 872  
##                                        Mean   :151.1   Mean   :1043  
##                                        3rd Qu.:192.0   3rd Qu.:1389  
##                                        Max.   :686.0   Max.   :4983  
##                                        NA's   :2988                  
##       hour           minute        time_hour                  
##  Min.   : 1.00   Min.   : 0.00   Min.   :2013-01-01 05:00:00  
##  1st Qu.: 9.00   1st Qu.: 8.00   1st Qu.:2013-04-04 13:00:00  
##  Median :13.00   Median :29.00   Median :2013-07-03 10:00:00  
##  Mean   :13.18   Mean   :26.24   Mean   :2013-07-03 05:03:10  
##  3rd Qu.:17.00   3rd Qu.:44.00   3rd Qu.:2013-10-01 07:00:00  
##  Max.   :23.00   Max.   :59.00   Max.   :2013-12-31 23:00:00  
## 
```

3. A possible base R equivalent of col_sum() is:

```r
col_sum3 <- function(df, f) {
  is_num <- sapply(df, is.numeric)  
  df_num <- df[ ,is_num]

  sapply(df_num, f)
}
```


But it has a number of bugs as illustrated with the following inputs:

```r
df <- tibble(
  x = 1:3, 
  y = 3:1,
  z = c("a", "b", "c")
)

col_sum3(df, mean) #ok
```

```
## x y 
## 2 2
```

```r
# Has problems: don't always return numeric vector
col_sum3(df[1:2], mean)
```

```
## x y 
## 2 2
```

```r
col_sum3(df[1], mean)
```

```
## x 
## 2
```

```r
#col_sum3(df[0], mean) #problematic
```


```r
df2 <- data.frame(
  x = 1:3, 
  y = 3:1,
  z = c("a", "b", "c")
)
col_sum3(df2, mean) 
col_sum3(df2[1:2], mean)
col_sum3(df2[1], mean)
col_sum3(df2[0], mean) #problematic
```

What causes the bugs?





